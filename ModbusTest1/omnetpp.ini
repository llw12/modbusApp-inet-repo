[General]
network = ModbusTest1
sim-time-limit = 20s


outputvectormanager-class="omnetpp::envir::SqliteOutputVectorManager"
outputscalarmanager-class="omnetpp::envir::SqliteOutputScalarManager"

*.*.eth[*].bitrate = 100Mbps


#Linking settings
*.*.ethg$o[*].channel.typename = "inet.node.ethernet.EthernetLink"
*.*.ethg$o[*].channel.datarate = 100Mbps
#*.*.ethg$o[*].channel.delay = 2ms
*.*.ethg$o[*].channel.ber = 0
*.*.ethg$o[*].channel.per = 0
*.*.ethg$o[*].channel.length = 10m #delay和length暴露一个，推荐暴露长度给用户配置


*.numClients = 2

*.operatorStation.numApps = 2
*.operatorStation.app[0].typename = "OperatorStationApp"
*.operatorStation.app[0].connectAddress = "server"
*.operatorStation.app[0].connectPort = 1000
*.operatorStation.app[0].interval = 0.5s

*.operatorStation.app[1].typename = "OperatorStationApp2"
*.operatorStation.app[1].connectAddress = "server"
*.operatorStation.app[1].connectPort = 666
#modbusRequest格式"主机名 从站Id 功能玛 起始地址 数量 数据;..."
*.operatorStation.app[1].modbusRequest = "client[0] 01 17 000A 000A 00 0A 00 0A 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00" 
*.operatorStation.app[1].sendTime = "4"
*.operatorStation.app[1].seed = 0

*.server.numApps = 3
*.server.app[0].typename = "ModbusMasterApp"  #app[0]必须为ModbusMasterApp，因为在ModbusTcpServerApp和TransitApp中需要通过^.app[0]获取ModbusMasterApp的实例化对象
*.server.app[0].numConnect = 2
*.server.app[0].configFile = "MasterConfig.json"  # 从站配置文件路径
*.server.app[0].readInterval = 5s                     # 定时读取间隔（1秒/次）

*.server.app[1].typename = "ModbusTcpServerApp"
*.server.app[1].localPort = 1000

*.server.app[2].typename = "TransitApp"
*.server.app[2].localPort = 666

**.tcp.typename = "Tcp"
**.tcp.advertisedWindow = 65535                      # 保持默认，需结合窗口缩放使用
**.tcp.delayedAcksEnabled = false                    # 保持禁用，避免ACK延迟
**.tcp.nagleEnabled = false                           # 禁用Nagle，加速小数据包传输
**.tcp.limitedTransmitEnabled = true                 # 启用有限传输，优化重传
**.tcp.increasedIWEnabled = true                     # 启用增大初始窗口，加速连接初期传输
**.tcp.sackSupport = true                            # 保持启用，减少无效重传
**.tcp.windowScalingSupport = true                   # 启用窗口缩放，突破64KB窗口限制
**.tcp.timestampSupport = true                       # 启用时间戳，优化RTT估算
**.tcp.mss = 1452                                    # 保持当前值，适配MTU
**.tcp.tcpAlgorithmClass = "TcpReno"              # 切换为TcpReno，提升丢包恢复性能

# misc settings
**.crcMode = "computed"
**.fcsMode = "computed"

# pcap recorder settings
*.server.numPcapRecorders = 1
*.server.pcapRecorder[*].pcapFile = "results/server.pcap"

# Visualizer settings
*.visualizer.interfaceTableVisualizer.displayInterfaceTables = true


[unHardInLoop]
*.client[*].numApps = 1
*.client[*].app[0].typename = "ModbusSlaveApp"
*.client[*].app[0].localPort = 502
*.client[*].app[0].slavesConfigPath = "SlaveConfig.json"


[HardInLoop]

scheduler-class = "inet::RealTimeScheduler"

*.client[0].numApps = 1
*.client[0].app[0].typename = "ModbusSlaveHILApp"
*.client[0].app[0].localPort = 502
*.client[0].app[0].remoteAddress = "113.54.219.26"
*.client[0].app[0].remotePort = 502


*.client[*].numApps = 1
*.client[*].app[0].typename = "ModbusSlaveApp"
*.client[*].app[0].localPort = 502
*.client[*].app[0].slavesConfigPath = "SlaveConfig.json"



